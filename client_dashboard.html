<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Client Dashboard - Gym10</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Navbar -->
    <nav class="bg-black">
      <div
        class="container mx-auto flex items-center justify-between py-4 px-6"
      >
        <div class="flex items-center gap-3">
          <img
            src="img/logo.jpg"
            alt="Gym10 Logo"
            class="h-10 w-10 rounded-full"
          />
          <span class="text-xl font-bold text-green-400">Gym10</span>
        </div>
        <ul class="flex gap-6">
          <li>
            <a
              href="#dashboard"
              class="text-white hover:text-green-400 transition"
              >Dashboard</a
            >
          </li>
          <li>
            <a
              href="#membership"
              class="text-white hover:text-green-400 transition"
              >Membership</a
            >
          </li>
          <li>
            <a
              href="booking.html"
              class="text-white hover:text-green-400 transition"
              >Bookings</a
            >
          </li>
          <li>
            <a
              href="account.html"
              class="text-white hover:text-green-400 transition"
              >Account</a
            >
          </li>
          <li>
            <a
              href="logout.php"
              class="ml-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
              >Logout</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <main class="container mx-auto py-10">
      <h1 class="text-3xl font-bold mb-6 text-center">
        Welcome, <span class="text-green-600" id="client-name">Loading...</span>
      </h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Membership Card -->
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-bold mb-4 text-green-600">Your Membership</h2>
          <div id="membership-info">
            <p>Loading your subscriptions...</p>
          </div>
          <a
            href="membership.html"
            class="mt-4 inline-block px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
            >Upgrade Plan</a
          >
        </div>
        <!-- Bookings Card -->
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-bold mb-4 text-green-600">
            Upcoming Bookings
          </h2>
          <div id="bookings-container">
            <p>Loading bookings...</p>
          </div>
          <a
            href="booking.html"
            class="mt-4 inline-block px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
            >Book a Class</a
          >
        </div>
      </div>
      <!-- Reviews Section -->
      <div class="mt-12">
        <h2 class="text-2xl font-bold mb-4 text-center text-green-600">
          Latest Reviews
        </h2>
        <div id="reviews-list" class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <p class="col-span-3 text-center">Loading reviews...</p>
        </div>
        <div class="text-center mt-6">
          <a
            href="all_reviews.html"
            class="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
            >View All Reviews</a
          >
        </div>
      </div>
    </main>

    <footer class="bg-black text-white py-6 mt-10">
      <div class="container mx-auto text-center">
        &copy; 2024 Gym10 - All Rights Reserved
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      // Load client info and subscriptions
      function loadSubscriptions() {
        $("#membership-info").html("<p>Loading your subscriptions...</p>");
        $.get(
          "web_services/subscription_service.php",
          function (data) {
            if (data.status === "success" && data.subscriptions.length > 0) {
              const sub = data.subscriptions[0];
              $("#client-name").text(sub.ClientName || "Member");
              let html = `
            <div>
              <div class="mb-2">Plan: <span class="font-semibold">${sub.PlanTypeName}</span></div>
              <div class="mb-2">Status: <span class="text-green-500 font-semibold">${sub.Status}</span></div>
              <div class="mb-2">Start: ${sub.StartDate}</div>
              <div class="mb-2">End: ${sub.EndDate}</div>
            </div>
          `;
              $("#membership-info").html(html);
            } else {
              $("#membership-info").html(
                "<p>No active subscriptions found. Please subscribe to a plan.</p>"
              );
            }
          },
          "json"
        );
      }

      // Load bookings
      function loadBookings() {
        $.get(
          "fetch_booking.php",
          function (bookings) {
            if (bookings.length > 0) {
              let html = '<ul class="space-y-2">';
              bookings.forEach(function (booking) {
                html += `
              <li class="flex justify-between items-center">
                <span>${booking.ClassName} - ${booking.BookingDate} ${booking.StartTime}</span>
                <button class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition" onclick="cancelBooking(${booking.BookingID})">Cancel</button>
              </li>
            `;
              });
              html += "</ul>";
              $("#bookings-container").html(html);
            } else {
              $("#bookings-container").html(
                "<p>You have no upcoming bookings. <a href='booking.html' class='text-green-600 underline'>Book a class now</a>!</p>"
              );
            }
          },
          "json"
        );
      }

      // Cancel booking
      function cancelBooking(bookingId) {
        if (!confirm("Are you sure you want to cancel this booking?")) return;
        $.ajax({
          url: "web_services/booking_service.php?booking_id=" + bookingId,
          type: "DELETE",
          dataType: "json",
          success: function (response) {
            if (response.status === "success") {
              alert("Booking cancelled successfully!");
              loadBookings();
            } else {
              alert("Failed to cancel booking: " + response.message);
            }
          },
          error: function () {
            alert("An error occurred. Please try again later.");
          },
        });
      }

      // Load reviews
      function loadReviews() {
        $.get(
          "web_services/review_service.php",
          function (data) {
            if (data.status === "success" && data.reviews.length > 0) {
              let html = "";
              data.reviews.slice(0, 3).forEach(function (review) {
                let stars = "";
                for (let i = 1; i <= 5; i++) {
                  stars +=
                    i <= review.Rating
                      ? '<span class="text-yellow-400">&#9733;</span>'
                      : '<span class="text-gray-300">&#9733;</span>';
                }
                html += `
              <div class="bg-white rounded-lg p-6 shadow">
                <h3 class="font-semibold text-green-600 mb-2">${review.TrainerName}</h3>
                <div class="mb-2">${stars}</div>
                <p>${review.Comments}</p>
                <p class="text-sm text-gray-500 mt-2">- ${review.ClientName}</p>
              </div>
            `;
              });
              $("#reviews-list").html(html);
            } else {
              $("#reviews-list").html(
                '<p class="col-span-3 text-center">No reviews found.</p>'
              );
            }
          },
          "json"
        );
      }

      $(function () {
        loadSubscriptions();
        loadBookings();
        loadReviews();
      });
    </script>
  </body>
</html>
